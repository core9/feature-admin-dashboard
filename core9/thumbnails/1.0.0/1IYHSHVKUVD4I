// Core9 - Module: module-platform-thumbnails
angular.module("core9Dashboard.thumbnails",["core9Dashboard.thumbnails.config","templates-module-platform-thumbnails"]),angular.module("core9Dashboard.admin.dashboard").requires.push("core9Dashboard.thumbnails"),angular.module("templates-module-platform-thumbnails",["thumbnails/edit.tpl.html","thumbnails/thumbnails.tpl.html"]),angular.module("thumbnails/edit.tpl.html",[]).run(["$templateCache",function(a){a.put("thumbnails/edit.tpl.html",'<h1 class="page-header">Edit image profile</h1>\n<div class="form-group row">\n  <label class="col-md-2 control-label">Name</label>\n  <div class="col-md-8">\n    <input type="text" ng-model="profile.name" class="form-control input-md" />\n  </div>\n</div>\n<div class="form-group row">\n  <label class="col-md-2 control-label">Bucket</label>\n  <div class="col-md-8">\n    <select class="form-control input-md" ng-model="selectedBucket" ng-options="bucket as bucket.name for bucket in buckets">\n      <option value="">Default</option>\n    </select>\n    <span class="help-text">The bucket in which the image cache will be stored. You can add more buckets under file manager settings.</span>\n  </div>\n</div>\n<div class="form-group row">\n  <label class="col-md-2 control-label">Width</label>\n  <div class="col-md-8">\n    <input type="number" ng-model="profile.width" class="form-control input-md" />\n  </div>\n</div>\n<div class="form-group row">\n  <label class="col-md-2 control-label">Height</label>\n  <div class="col-md-8">\n    <input type="number" ng-model="profile.height" class="form-control input-md" />\n  </div>\n</div>\n<fieldset>\n  <legend>Actions</legend>\n  <button class="btn btn-success" ng-click="save()">Save</button>\n</fieldset>')}]),angular.module("thumbnails/thumbnails.tpl.html",[]).run(["$templateCache",function(a){a.put("thumbnails/thumbnails.tpl.html",'<h1 class="page-header">Image settings</h1>\n<table class="table table-striped">\n  <tr>\n    <th>Profile name</th>\n    <th>Actions</th>\n  </tr>\n  <tr ng-repeat="profile in profiles">\n    <td>{{profile.name}}</td>\n    <td>\n      <button class="btn btn-success" ng-click="edit(profile)"><i class="fa fa-cog"></i></button>\n      <button class="btn btn-warning" ng-click="flush(profile)"><i class="fa fa-refresh"></i></button>\n      <button class="btn btn-danger" ng-click="remove(profile, $index)"><i class="fa fa-trash-o"></i></button>\n    </td>\n  </tr>\n  <tr>\n    <td>\n      <div class="form-group">\n        <input ng-model="newName" type="text" placeholder="New widget name" class="form-control input-md">\n      </div>\n    </td>\n    <td>\n      <button class="btn btn-success" ng-click="add(newName)"><i class="fa fa-plus"></i> New profile</button>\n    </td>\n  </tr>\n</table>')}]),angular.module("core9Dashboard.thumbnails.config",["ui.router"]).config(["$stateProvider",function(a){a.state("thumbnails",{url:"/config/thumbnails",views:{main:{controller:"ThumbnailsCtrl",templateUrl:"thumbnails/thumbnails.tpl.html"}},data:{pageTitle:"Thumbnails",context:"thumbnailscontext",sidebar:"config"}}).state("thumbnail",{url:"/config/thumbnail/:id",views:{main:{controller:"ThumbnailsEditCtrl",templateUrl:"thumbnails/edit.tpl.html"}},data:{pageTitle:"Edit image profile",context:"thumbnailscontext",sidebar:"config"},resolve:{profile:["ConfigFactory","$stateParams",function(a,b){return a.get({configtype:"imageprofile",id:b.id})}]}})}]).controller("ThumbnailsCtrl",["$scope","$http","$state","ConfigFactory",function(a,b,c,d){a.profiles=d.query({configtype:"imageprofile"}),a.edit=function(a){c.go("thumbnail",{id:a._id})},a.add=function(b){var c=new d;c.configtype="imageprofile",c.name=b,c.$save(),a.profiles.push(c)},a.remove=function(b,c){b.$remove(function(){a.profiles.splice(c,1)})},a.flush=function(){b.post("/admin/images/flush").success(function(){alert("Image caches flushed.")}).error(function(b){a.$emit("$error",b)})},a.flush=function(c){var d="";void 0!==c&&(d="/"+c.name),b.post("/admin/images/flush"+d).success(function(){alert("Image cache flushed.")}).error(function(b){a.$emit("$error",b)})},a.refresh=function(){b.post("/admin/images/refresh").success(function(){alert("Image profiles refreshed.")}).error(function(b){a.$emit("$error",b)})}}]).controller("ThumbnailsEditCtrl",["$scope","$state","profile","ConfigFactory",function(a,b,c,d){a.buckets=d.query({configtype:"bucket"},function(b){if(void 0===c.bucket||""===c.bucket)a.bucket="";else for(var d=b.length-1;d>=0;d--)b[d].name===c.bucket&&(a.selectedBucket=b[d])}),a.profile=c,a.$watch("selectedBucket",function(){void 0===a.selectedBucket||null===a.selectedBucket||""===a.selectedBucket?(a.profile.bucket="",a.profile.database=""):(a.profile.bucket=a.selectedBucket.name,a.profile.database=a.selectedBucket.database)}),a.save=function(){a.profile.$update(),b.go("thumbnails")}}]).run(["MenuService",function(a){a.add("config",{title:"Image profiles",weight:200,link:"thumbnails"}),a.add("thumbnailscontext",{title:"Refresh profiles",weight:0,link:"thumbnailsrefresh",template:'<a href="" ng-controller="ThumbnailsCtrl" ng-click="refresh()">Refresh profiles</a>'}),a.add("thumbnailscontext",{title:"Flush profiles",weight:0,link:"thumbnailsflush",template:'<a href="" ng-controller="ThumbnailsCtrl" ng-click="flush()">Flush profiles</a>'})}]);