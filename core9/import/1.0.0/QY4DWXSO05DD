// Core9 - Module: module-cms-import
angular.module("core9.importer.csv",[]).controller("coreImporterCSVCtrl",["$scope","$http",function(a,b){a.retrieveHead=function(){a.importer.$update(function(){b.get("admin/importer/head/"+a.importer._id).success(function(b){void 0===a.importer.processorOptions.fields&&(a.importer.processorOptions.fields=[]);for(var c=0;c<b.length;c++){for(var d=!1,e=0;e<a.importer.processorOptions.fields.length&&d===!1;e++)a.importer.processorOptions.fields[e].name===b[c]&&(d=!0);d||a.importer.processorOptions.fields.push({name:b[c]})}})})}}]),angular.module("core9.importer",["ui.router","core9Dashboard.config","core9Dashboard.menu"]).config(["$stateProvider",function(a){a.state("importers",{url:"/config/importers",views:{main:{controller:"ImportersListCtrl",templateUrl:"importer/importer.list.tpl.html"}},data:{pageTitle:"Importers",sidebar:"config"}}).state("importer",{url:"/config/importers/:importer",views:{main:{controller:"ImporterCtrl",templateUrl:"importer/importer.tpl.html"}},resolve:{processors:["Processors",function(a){return a.getProcessors()}]},data:{pageTitle:"Importer",sidebar:"config"}})}]).factory("Processors",["$q","$http",function(a,b){var c=[];return this.getProcessors=function(){var d=a.defer();return c.length>0?d.resolve(c):b.get("/admin/importer/processor").success(function(a){c=a,d.resolve(a)}),d.promise},this}]).directive("cnImporterTemplate",["$compile","$templateCache",function(a,b){return{replace:!1,scope:{template:"=cnTemplate"},link:function(c,d){c.$watch("template",function(){void 0!==c.template&&(d.html(b.get(c.template)),a(d.contents)(c))})}}}]).controller("ImportersListCtrl",["$scope","$state","ConfigFactory","$http",function(a,b,c,d){c.query({configtype:"importer"},function(b){a.importers=b}),a.addImporter=function(b){var d=new c({configtype:"importer"});d.name=b,d.processorOptions={},d.$save(function(b){a.importers.push(b)})},a.edit=function(a){b.go("importer",{importer:a._id})},a.remove=function(b){b.$remove(function(){a.importers=c.query({configtype:"importer"})})},a.execute=function(a){d.post("/admin/importer/import/"+a._id).success(function(){console.log("success")})}}]).controller("ImporterCtrl",["$scope","$compile","$state","$stateParams","ConfigFactory","processors",function(a,b,c,d,e,f){a.processors=f,a.importer=e.get({configtype:"importer",id:d.importer}),a.back=function(){c.go("importers")},a.save=function(){a.importer.$update(function(){c.go("importers")})},a.$watch("importer.processor",function(b){for(var c=0;c<f.length;c++)f[c].processorIdentifier==b&&(a.processor=f[c],void 0===a.importer.processorOptions&&(a.importer.processorOptions={}))})}]).run(["MenuService",function(a){a.add("config",{title:"Importers",weight:400,link:"importers"})}]),angular.module("core9Dashboard.import",["core9.importer","core9.importer.csv","templates-module-cms-import"]),angular.module("core9Dashboard.admin.dashboard").requires.push("core9Dashboard.import"),angular.module("templates-module-cms-import",["importer/csv/csv.tpl.html","importer/importer.list.tpl.html","importer/importer.tpl.html"]),angular.module("importer/csv/csv.tpl.html",[]).run(["$templateCache",function(a){a.put("importer/csv/csv.tpl.html",'<div ng-controller="coreImporterCSVCtrl">\n	<fieldset>\n		<legend>Configuration</legend>\n    <div class="form-group row">\n      <label class="col-md-2 control-label">Collection</label>\n      <div class="col-md-8">\n        <input ng-model="importer.processorOptions.collection" type="text" class="form-control input-md" />\n      </div>\n    </div>\n    <div class="form-group row">\n      <label class="col-md-2 control-label">ContentType</label>  \n      <div class="col-md-8">\n        <input ng-model="importer.processorOptions.contenttype" type="text" class="form-control input-md" />\n      </div>\n    </div>\n    <div class="form-group row">\n      <label class="col-md-2 control-label">Separator</label>  \n      <div class="col-md-8">\n        <input ng-model="importer.processorOptions.separator" type="text" class="form-control input-md" />\n      </div>\n    </div>\n    <div class="form-group row">\n      <label class="col-md-2 control-label">Primary Key</label>  \n      <div class="col-md-8">\n        <input ng-model="importer.processorOptions.primaryKey" type="text" class="form-control input-md" />\n      </div>\n    </div>\n    <div class="form-group row">\n      <label class="col-md-2 control-label">URL</label>  \n      <div class="col-md-8">\n        <input ng-model="importer.processorOptions.url" type="text" class="form-control input-md" />\n      </div>\n    </div>\n	</fieldset>\n	<fieldset>\n		<legend>Fields</legend>\n		<table class="table table-striped">\n			<tr>\n				<th>Name</th>\n				<th>NotNull</th>\n				<th>ParseInt</th>\n			</tr>\n			<tr ng-repeat="field in importer.processorOptions.fields">\n				<td>{{field.name}}</td>\n				<td><input type="checkbox" ng-model="field.notNull" /></td>\n				<td><input type="checkbox" ng-model="field.parseInt" /></td>\n			</tr>	\n		</table>\n		<button class="btn btn-success" ng-click="retrieveHead()">Retrieve header</button>\n	</fieldset>\n</div>')}]),angular.module("importer/importer.list.tpl.html",[]).run(["$templateCache",function(a){a.put("importer/importer.list.tpl.html",'<h1 class="page-header">Importers <small><i class="icon-double-angle-right"></i> Configure your importers</small></h1>\n<blockquote>You can run and configure your importers from here.</blockquote>\n<div>\n	<table class="table table-striped">\n		<tr>\n			<th>Name</th>\n      <th>Actions</th>\n    </tr>\n    <tr ng-repeat="importer in importers">\n      <td>{{importer.name}}</td>\n      <td>\n       <button class="btn btn-success" ng-click="edit(importer)"><i class="fa fa-pencil"></i></button>\n       <button class="btn btn-danger" ng-click="remove(importer)"><i class="fa fa-trash-o"></i></button>\n       <button class="btn btn-success" ng-click="execute(importer)">Execute</button>\n     </td>\n   </tr>\n   <tr>\n    <td>\n      <div class="form-group">\n        <input ng-model="newName" type="text" placeholder="New importer name" class="form-control input-md">\n      </div>\n    </td>\n    <td>\n      <button class="btn btn-success" ng-click="addImporter(newName)"><i class="fa fa-plus"></i> New importer</button>\n    </td>\n  </tr>\n </table>\n</div>')}]),angular.module("importer/importer.tpl.html",[]).run(["$templateCache",function(a){a.put("importer/importer.tpl.html",'<h1 class="page-header">Importer - {{importer.name}} <small><i class="icon-double-angle-right"></i> setup</small></h1>\n<div class="form-group row">\n  <label class="col-md-2 control-label">Name</label>  \n  <div class="col-md-8">\n    <input ng-model="importer.name" type="text" class="form-control input-md" />\n    <span class="help-block">A unique name for the importer</span>\n  </div>\n</div>\n<div class="form-group row">\n  <label class="col-md-2 control-label">Name</label>  \n  <div class="col-md-8">\n    <select ng-options="processor.processorIdentifier as processor.processorName for processor in processors" ng-model="importer.processor" class="form-control">\n      <option value=""></option>\n    </select>\n    <span class="help-block">A unique name for the importer</span>\n  </div>\n</div>\n\n<div ng-if="processor.template !== null" ng-include="processor.template" />\n<div ng-if="processor.template === null"cn-schema-generator cn-schema="processor.processorConfig" cn-data="importer.processorOptions" cn-options="processor.processorOptions" />\n\n<fieldset>\n  <legend>Actions</legend>\n  <button class="btn btn-success" ng-click="save()">Save</button>\n  <button class="btn btn-warning" ng-click="back()">Back</button>\n</fieldset>')}]);