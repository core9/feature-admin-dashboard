// Core9 - Module: module-cms-import
angular.module("core9.importer.csv",[]).controller("coreImporterCSVCtrl",["$scope","$http",function(a,b){a.retrieveHead=function(){a.importer.$update(function(){b.get("admin/importer/head/"+a.importer._id).success(function(b){void 0===a.importer.processorOptions.fields&&(a.importer.processorOptions.fields=[]);for(var c=0;c<b.length;c++){for(var d=!1,e=0;e<a.importer.processorOptions.fields.length&&d===!1;e++)a.importer.processorOptions.fields[e].name===b[c]&&(d=!0);d||a.importer.processorOptions.fields.push({name:b[c]})}})})}}]),angular.module("core9.importer",["ui.router","core9Dashboard.config","core9Dashboard.menu"]).config(["$stateProvider",function(a){a.state("importers",{url:"/config/importers",views:{main:{controller:"ImportersListCtrl",templateUrl:"importer/importer.list.tpl.html"}},data:{pageTitle:"Importers"}}).state("importer",{url:"/config/importers/:importer",views:{main:{controller:"ImporterCtrl",templateUrl:"importer/importer.tpl.html"}},resolve:{processors:["Processors",function(a){return a.getProcessors()}]},data:{pageTitle:"Importer"}})}]).factory("Processors",["$q","$http",function(a,b){var c=[];return this.getProcessors=function(){var d=a.defer();return c.length>0?d.resolve(c):b.get("/admin/importer/processor").success(function(a){c=a,d.resolve(a)}),d.promise},this}]).directive("cnImporterTemplate",["$compile","$templateCache",function(a,b){return{replace:!1,scope:{template:"=cnTemplate"},link:function(c,d){c.$watch("template",function(){void 0!==c.template&&(d.html(b.get(c.template)),a(d.contents)(c))})}}}]).controller("ImportersListCtrl",["$scope","$state","ConfigFactory","$http",function(a,b,c,d){c.query({configtype:"importer"},function(b){a.importers=b}),a.addImporter=function(b){var d=new c({configtype:"importer"});d.name=b,d.processorOptions={},d.$save(function(b){a.importers.push(b)})},a.edit=function(a){b.go("importer",{importer:a._id})},a.remove=function(b){b.$remove(function(){a.importers=c.query({configtype:"importer"})})},a.execute=function(a){d.post("/admin/importer/import/"+a._id).success(function(){console.log("success")})}}]).controller("ImporterCtrl",["$scope","$compile","$state","$stateParams","ConfigFactory","processors",function(a,b,c,d,e,f){a.processors=f,a.importer=e.get({configtype:"importer",id:d.importer}),a.back=function(){c.go("importers")},a.save=function(){a.importer.$update(function(){c.go("importers")})},a.$watch("importer.processor",function(b){for(var c=0;c<f.length;c++)f[c].processorIdentifier==b&&(a.processor=f[c],void 0===a.importer.processorOptions&&(a.importer.processorOptions={}))})}]).run(["MenuService",function(a){a.add("config",{title:"Importers",weight:400,link:"/config/importers"})}]),angular.module("core9Dashboard.import",["core9.importer","core9.importer.csv","templates-module-cms-import"]),angular.module("templates-module-cms-import",["importer/csv/csv.tpl.html","importer/importer.list.tpl.html","importer/importer.tpl.html"]),angular.module("importer/csv/csv.tpl.html",[]).run(["$templateCache",function(a){a.put("importer/csv/csv.tpl.html",'<div ng-controller="coreImporterCSVCtrl">\n	<fieldset>\n		<legend>Configuration</legend>\n		<div class="input-group">\n			<span class="input-group-addon ng-binding">Collection</span>\n			<input type="text" class="form-control" ng-model="importer.processorOptions.collection">\n		</div>\n		<div class="input-group">\n			<span class="input-group-addon ng-binding">ContentType</span>\n			<input type="text" class="form-control" ng-model="importer.processorOptions.contenttype">\n		</div>\n		<div class="input-group">\n			<span class="input-group-addon ng-binding">Separator</span>\n			<input type="text" class="form-control" ng-model="importer.processorOptions.separator">\n		</div>\n		<div class="input-group">\n			<span class="input-group-addon ng-binding">Primary Key</span>\n			<input type="text" class="form-control" ng-model="importer.processorOptions.primaryKey">\n		</div>\n		<div class="input-group">\n			<span class="input-group-addon ng-binding">URL</span>\n			<input type="text" class="form-control" ng-model="importer.processorOptions.url">\n		</div>\n	</fieldset>\n	<fieldset>\n		<legend>Fields</legend>\n		<table>\n			<tr>\n				<th>Name</th>\n				<th>NotNull</th>\n				<th>ParseInt</th>\n			</tr>\n			<tr ng-repeat="field in importer.processorOptions.fields">\n				<td class="input-group-addon">{{field.name}}</td>\n				<td class="form-control"><input type="checkbox" ng-model="field.notNull" /></td>\n				<td class="form-control"><input type="checkbox" ng-model="field.parseInt" /></td>\n			</tr>	\n		</table>\n		<button class="btn btn-success" ng-click="retrieveHead()">Retrieve header</button>\n	</fieldset>\n</div>')}]),angular.module("importer/importer.list.tpl.html",[]).run(["$templateCache",function(a){a.put("importer/importer.list.tpl.html",'<div>\n	<h2>Importers</h2> Configure your importers\n	<div>\n		<table>\n			<tr>\n				<th>Name</th>\n				<th>Actions</th>\n			</tr>\n			<tr ng-repeat="importer in importers">\n				<td>{{importer.name}}</td>\n				<td>\n					<button class="btn btn-success" ng-click="edit(importer)"><i class="fa fa-pencil"></i></button>\n					<button class="btn btn-danger" ng-click="remove(importer)"><i class="fa fa-trash-o"></i></button>\n					<button class="btn btn-success" ng-click="execute(importer)">Execute</button>\n				</td>\n			</tr>\n		</table>\n	</div>\n	<div>\n		<input type="text" ng-model="newImporter" />\n		<button class="btn btn-success" ng-click="addImporter(newImporter)">Add</button>\n	</div>\n</div>')}]),angular.module("importer/importer.tpl.html",[]).run(["$templateCache",function(a){a.put("importer/importer.tpl.html",'<div>\n	<h2>Importer - {{importer.name}}</h2>\n	<form>\n		<table>\n			<tr>\n				<th><label>Name</label></th>\n				<td><input type="text" ng-model="importer.name" /></td>\n			</tr>\n			<tr>\n				<th><label>Processor</label></th>\n				<td>\n					<select ng-options="processor.processorIdentifier as processor.processorName for processor in processors" ng-model="importer.processor">\n						<option value=""></option>\n					</select>\n				</td>\n			</tr>\n		</table>\n		<div ng-if="processor.template !== null" ng-include="processor.template" />\n		<div ng-if="processor.template === null"cn-schema-generator cn-schema="processor.processorConfig" cn-data="importer.processorOptions" cn-options="processor.processorOptions" />\n	</form>\n	<button class="btn btn-success" ng-click="save()">Save</button>\n	<button class="btn btn-success" ng-click="back()">Back</button>\n	<div>\n		<pre>{{importer|json}}</pre>\n		<pre>{{processor|json}}</pre>\n	</div>\n</div>')}]);