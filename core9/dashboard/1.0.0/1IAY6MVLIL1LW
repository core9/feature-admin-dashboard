// Core9 - Module: module-platform-users
angular.module("core9Dashboard.users",["core9Dashboard.users.config","templates-module-platform-users"]),angular.module("core9Dashboard.admin.dashboard").requires.push("core9Dashboard.users"),angular.module("templates-module-platform-users",["users/edit.tpl.html","users/processor.modal.tpl.html","users/processor.tpl.html","users/role.tpl.html","users/users.tpl.html"]),angular.module("users/edit.tpl.html",[]).run(["$templateCache",function(a){a.put("users/edit.tpl.html",'<h1 class="page-header">Edit user</h1>\n<div class="form-group row">\n  <label class="col-md-2 control-label">Username</label>\n  <div class="col-md-8">\n    <input type="text" ng-model="user.username" class="form-control input-md" />\n  </div>\n</div>\n<div class="form-group row">\n  <label class="col-md-2 control-label">Password</label>\n  <div class="col-md-8">\n    <input type="text" ng-model="newPassword" class="form-control input-md" placeholder="Enter a new password" />\n  </div>\n</div>\n<div class="form-group row">\n  <label class="col-md-2 control-label">Salt</label>\n  <div class="col-md-8">\n    <input type="text" ng-model="user.salt" class="form-control input-md" />\n  </div>\n</div>\n<div class="form-group row">\n  <label class="col-md-2 control-label">Roles</label>\n  <div class="col-md-8">\n    <table class="table table-striped">\n      <tr>\n        <th>Role</th>\n        <th>Actions</th>\n      </tr>\n      <tr ng-repeat="role in user.roles">\n        <td>{{role}}</td>\n        <td><button class="btn btn-danger" ng-click="user.roles.splice($index,1)"><i class="fa fa-trash-o"></i></button></td>\n      </tr>\n      <tr>\n        <td><input type="text" ng-model="newRole" class="form-control input-md"></td>\n        <td><button class="btn btn-success" ng-click="user.roles.push(newRole)"><i class="fa fa-plus"></i></button></td>\n      </tr>\n    </table>\n  </div>\n</div>\n<fieldset>\n  <legend>Actions</legend>\n  <button class="btn btn-success" ng-click="save()">Save</button>\n</fieldset>')}]),angular.module("users/processor.modal.tpl.html",[]).run(["$templateCache",function(a){a.put("users/processor.modal.tpl.html",'<div>\n  <div class="modal-header">\n    <h3>Select your users</h3>\n  </div>\n  <div class="modal-body">\n    <table class="table table-striped" ng-show="users.length > 0">\n      <thead>\n        <tr>\n          <th>ID</th>\n          <th>Username</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr ng-repeat="user in users">\n          <td ng-click="select(user)" ng-class="{\'bg-success\': isSelected(user.id)}">{{user.id}}</td>\n          <td ng-click="select(user)" ng-class="{\'bg-success\': isSelected(user.id)}">{{user.username}}</td>\n        </tr>\n      </tbody>\n    </table>\n  </fieldset>\n</div>\n<div class="modal-footer">\n  <button class="btn btn-primary" ng-click="ok()">OK</button>\n</div>\n</div>')}]),angular.module("users/processor.tpl.html",[]).run(["$templateCache",function(a){a.put("users/processor.tpl.html",'<div ng-controller="FeatureProcessorUserCtrl">\n  <button class="btn btn-success" ng-click="add()" style="width: 100%">Add users</button>\n  <h6>Selected (<a ng-click="showSelected = !showSelected">toggle</a>)</h6>\n  <ul class="list-group" ng-show="showSelected">\n    <li ng-repeat="item in selected" class="list-group-item" ng-click="deselect($index)">\n      <a>{{item.id}}</a>\n    </li>\n  </ul>\n</div>\n')}]),angular.module("users/role.tpl.html",[]).run(["$templateCache",function(a){a.put("users/role.tpl.html",'<h1 class="page-header">Edit role</h1>\n<div class="form-group row">\n  <label class="col-md-2 control-label">Role name</label>\n  <div class="col-md-8">\n    <input type="text" ng-model="role.name" class="form-control input-md" />\n  </div>\n</div>\n<div class="form-group row">\n  <label class="col-md-2 control-label">Permissions</label>\n  <div class="col-md-8">\n    <table class="table table-striped">\n      <tr>\n        <th>Permission</th>\n        <th>Actions</th>\n      </tr>\n      <tr ng-repeat="permission in role.permissions">\n        <td>{{permission}}</td>\n        <td><button class="btn btn-danger" ng-click="role.permissions.splice($index,1)"><i class="fa fa-trash-o"></i></button></td>\n      </tr>\n      <tr>\n        <td><input type="text" ng-model="newRole" class="form-control input-md"></td>\n        <td><button class="btn btn-success" ng-click="role.permissions.push(newRole)"><i class="fa fa-plus"></i></button></td>\n      </tr>\n    </table>\n  </div>\n</div>\n<fieldset>\n  <legend>Actions</legend>\n  <button class="btn btn-success" ng-click="save()">Save</button>\n</fieldset>')}]),angular.module("users/users.tpl.html",[]).run(["$templateCache",function(a){a.put("users/users.tpl.html",'<h1 class="page-header">User management</h1>\n<tabset>\n  <tab heading="Users">\n    <table class="table table-striped">\n      <tr>\n        <th>Username</th>\n        <th>Actions</th>\n      </tr>\n      <tr ng-repeat="user in users">\n        <td>{{user.username}}</td>\n        <td>\n          <button class="btn btn-success" ng-click="edit(user)"><i class="fa fa-cog"></i></button>\n          <button class="btn btn-danger" ng-click="remove(user, $index)"><i class="fa fa-trash-o"></i></button>\n        </td>\n      </tr>\n      <tr>\n        <td>\n          <div class="form-group">\n            <input ng-model="newName" type="text" placeholder="New username" class="form-control input-md">\n          </div>\n        </td>\n        <td>\n          <button class="btn btn-success" ng-click="add(newName)"><i class="fa fa-plus"></i> New user</button>\n        </td>\n      </tr>\n    </table>\n  </tab>\n  <tab heading="Roles">\n    <table class="table table-striped">\n      <tr>\n        <th>Role name</th>\n        <th>Actions</th>\n      </tr>\n      <tr ng-repeat="role in roles">\n        <td>{{role.name}}</td>\n        <td>\n          <button class="btn btn-success" ng-click="editrole(role)"><i class="fa fa-cog"></i></button>\n          <button class="btn btn-danger" ng-click="removerole(role, $index)"><i class="fa fa-trash-o"></i></button>\n        </td>\n      </tr>\n      <tr>\n        <td>\n          <div class="form-group">\n            <input ng-model="newRole" type="text" placeholder="New role name" class="form-control input-md">\n          </div>\n        </td>\n        <td>\n          <button class="btn btn-success" ng-click="addrole(newRole)"><i class="fa fa-plus"></i> New role</button>\n        </td>\n      </tr>\n    </table>\n  </tab>\n</tabset>')}]),angular.module("core9Dashboard.users.config",["ui.router","ui.bootstrap","core9Dashboard.config","core9Dashboard.menu","ngResource"]).factory("UserResource",["$resource",function(a){return a("/admin/authentication/user/:userid",{userid:"@id"},{update:{method:"PUT"}})}]).config(["$stateProvider",function(a){a.state("users",{url:"/config/users",views:{main:{controller:"UsersCtrl",templateUrl:"users/users.tpl.html"}},data:{pageTitle:"Users",context:"userscontext",sidebar:"config"}}).state("user",{url:"/config/user/:id",views:{main:{controller:"UsersEditCtrl",templateUrl:"users/edit.tpl.html"}},data:{pageTitle:"Edit user",context:"userscontext",sidebar:"config"},resolve:{user:["UserResource","$stateParams",function(a,b){return a.get({userid:b.id})}]}}).state("role",{url:"/config/role/:id",views:{main:{controller:"RoleEditCtrl",templateUrl:"users/role.tpl.html"}},resolve:{role:["ConfigFactory","$stateParams",function(a,b){return a.get({configtype:"userrole",id:b.id})}]},data:{pageTitle:"Edit role",context:"userscontext",sidebar:"config"}})}]).controller("UsersCtrl",["$scope","$state","UserResource","ConfigFactory",function(a,b,c,d){a.users=c.query(),a.roles=d.query({configtype:"userrole"}),a.add=function(b){var d=new c;d.username=b,d.roles=[],d.$save(function(b){a.users.push(b),a.edit(b)})},a.addrole=function(b){var c=new d;c.configtype="userrole",c.name=b,c.permissions=[],c.$save(function(b){a.roles.push(b),a.editrole(b)})},a.edit=function(a){b.go("user",{id:a.id})},a.editrole=function(a){b.go("role",{id:a._id})},a.remove=function(b,c){b.$remove(function(){a.users.splice(c,1)})},a.removerole=function(b,c){b.$remove(function(){a.roles.splice(c,1)})}}]).controller("UsersEditCtrl",["$scope","$state","user",function(a,b,c){a.user=c,a.newPassword="",a.save=function(){""!==a.newPassword&&(a.user.newPassword=a.newPassword),a.user.$update(),b.go("users")}}]).controller("RoleEditCtrl",["$scope","$state","role",function(a,b,c){a.role=c,a.newPassword="",a.save=function(){""!==a.newPassword&&(a.user.newPassword=a.newPassword),a.user.$update(),b.go("users")}}]).controller("FeatureProcessorUserCtrl",["$scope","$modal",function(a,b){a.deselect=function(b){a.$parent.selected.splice(b,1)},a.add=function(){b.open({templateUrl:"users/processor.modal.tpl.html",controller:"FeatureProcessorUserModalCtrl",resolve:{selected:function(){return a.$parent.selected}}})}}]).controller("FeatureProcessorUserModalCtrl",["$scope","$modalInstance","UserResource","selected",function(a,b,c,d){a.users=c.query(),a.isSelected=function(a){for(var b=0;b<d.length;b++)if(d[b].id===a)return!0;return!1},a.select=function(a){for(var b=!1,c=0;c<d.length;c++)d[c].id===a.id&&(b=!0,d.splice(c,1));b||d.push({id:a.id,entry:a})},a.ok=function(){b.close()}}]).run(["MenuService",function(a){a.add("config",{title:"Users",weight:200,link:"users"})}]);